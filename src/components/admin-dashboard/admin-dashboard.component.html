<div class="flex h-screen bg-gray-100 dark:bg-gray-900 font-sans">
  <!-- Mobile Sidebar Backdrop -->
  @if(isSidebarOpen()) {
    <div (click)="isSidebarOpen.set(false)" class="fixed inset-0 bg-black/60 z-30 sm:hidden"></div>
  }

  <!-- Sidebar -->
  <div 
    class="w-64 bg-white dark:bg-gray-800 text-gray-800 dark:text-white flex flex-col border-r border-gray-200 dark:border-gray-700 fixed inset-y-0 left-0 z-40 transform transition-transform duration-300 ease-in-out sm:relative sm:translate-x-0"
    [class.-translate-x-full]="!isSidebarOpen()"
    [class.translate-x-0]="isSidebarOpen()">
    
    <!-- Sidebar Header -->
    <div class="px-6 py-5 border-b border-gray-200 dark:border-gray-700">
      <h1 class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">Admin Panel</h1>
      <p class="text-sm text-gray-500 dark:text-gray-400">Payroll & HR Management</p>
    </div>
    
    <!-- Navigation -->
    <nav class="flex-1 px-4 py-4 space-y-1">
        <a href="#" (click)="setActiveTab('analytics'); isSidebarOpen.set(false); $event.preventDefault()" class="flex items-center px-4 py-2.5 rounded-lg transition-colors duration-200" [class.bg-indigo-600]="activeTab() === 'analytics'" [class.text-white]="activeTab() === 'analytics'" [class.hover:bg-gray-100]="activeTab() !== 'analytics'" [class.dark:hover:bg-gray-700]="activeTab() !== 'analytics'">
           <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z" /></svg>
           <span class="ml-3 font-medium">Analytics</span>
        </a>
        <a href="#" (click)="setActiveTab('manage-employees'); isSidebarOpen.set(false); $event.preventDefault()" class="flex items-center px-4 py-2.5 rounded-lg transition-colors duration-200" [class.bg-indigo-600]="activeTab() === 'manage-employees'" [class.text-white]="activeTab() === 'manage-employees'" [class.hover:bg-gray-100]="activeTab() !== 'manage-employees'" [class.dark:hover:bg-gray-700]="activeTab() !== 'manage-employees'">
           <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-4.67c.625-.934 1-2.122 1-3.417v-.175a6.375 6.375 0 015.375-6.232A12.318 12.318 0 0118.375 3.625c-2.331 0-4.512.645-6.374 1.766l-.001.109a6.375 6.375 0 01-11.964 4.67c-.625.934-1 2.122-1-3.417v.175a6.375 6.375 0 01-5.375 6.232A12.318 12.318 0 016.625 19.375c2.331 0 4.512-.645 6.374-1.766l.001.109z" /></svg>
           <span class="ml-3 font-medium">Manage Employees</span>
        </a>
        <a href="#" (click)="setActiveTab('dtr'); isSidebarOpen.set(false); $event.preventDefault()" class="flex items-center px-4 py-2.5 rounded-lg transition-colors duration-200" [class.bg-indigo-600]="activeTab() === 'dtr'" [class.text-white]="activeTab() === 'dtr'" [class.hover:bg-gray-100]="activeTab() !== 'dtr'" [class.dark:hover:bg-gray-700]="activeTab() !== 'dtr'">
           <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
           <span class="ml-3 font-medium">DTR Logs</span>
        </a>
        <a href="#" (click)="setActiveTab('payroll'); isSidebarOpen.set(false); $event.preventDefault()" class="flex items-center px-4 py-2.5 rounded-lg transition-colors duration-200" [class.bg-indigo-600]="activeTab() === 'payroll'" [class.text-white]="activeTab() === 'payroll'" [class.hover:bg-gray-100]="activeTab() !== 'payroll'" [class.dark:hover:bg-gray-700]="activeTab() !== 'payroll'">
           <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" /></svg>
           <span class="ml-3 font-medium">Payroll History</span>
        </a>
        <a href="#" (click)="setActiveTab('manage-payroll'); isSidebarOpen.set(false); $event.preventDefault()" class="flex items-center px-4 py-2.5 rounded-lg transition-colors duration-200" [class.bg-indigo-600]="activeTab() === 'manage-payroll'" [class.text-white]="activeTab() === 'manage-payroll'" [class.hover:bg-gray-100]="activeTab() !== 'manage-payroll'" [class.dark:hover:bg-gray-700]="activeTab() !== 'manage-payroll'">
            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" /></svg>
            <span class="ml-3 font-medium">Manage Payroll</span>
        </a>
        <a href="#" (click)="setActiveTab('daily-logs'); isSidebarOpen.set(false); $event.preventDefault()" class="flex items-center px-4 py-2.5 rounded-lg transition-colors duration-200" [class.bg-indigo-600]="activeTab() === 'daily-logs'" [class.text-white]="activeTab() === 'daily-logs'" [class.hover:bg-gray-100]="activeTab() !== 'daily-logs'" [class.dark:hover:bg-gray-700]="activeTab() !== 'daily-logs'">
          <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.888c-.995 0-1.793.813-1.793 1.823v8.132a2.25 2.25 0 002.25 2.25h9.75a2.25 2.25 0 002.25-2.25v-.332m-13.5 0a48.547 48.547 0 01-1.07-1.818" />
          </svg>
          <span class="ml-3 font-medium">Daily Logs</span>
        </a>
        @if (currentUserRole() === 'superadmin') {
            <a href="#" (click)="setActiveTab('recovery'); isSidebarOpen.set(false); $event.preventDefault()" class="flex items-center px-4 py-2.5 rounded-lg transition-colors duration-200" [class.bg-indigo-600]="activeTab() === 'recovery'" [class.text-white]="activeTab() === 'recovery'" [class.hover:bg-gray-100]="activeTab() !== 'recovery'" [class.dark:hover:bg-gray-700]="activeTab() !== 'recovery'">
              <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
              </svg>
              <span class="ml-3 font-medium">Recovery Bin</span>
            </a>
        }
    </nav>
    
    <!-- Sidebar Footer -->
    <div class="px-4 py-4 mt-auto border-t border-gray-200 dark:border-gray-700 space-y-4">
      <button (click)="openTimeClockWindow()" class="w-full flex items-center justify-center px-4 py-2.5 rounded-lg bg-emerald-500 hover:bg-emerald-600 text-white font-semibold transition-colors duration-200">
          <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.776 48.776 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" /><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" /></svg>
          Time Clock Mode
      </button>
       @if (logoutError()) {
        <div class="p-2 text-xs text-center text-red-200 bg-red-800/50 rounded-md">
          {{ logoutError() }}
        </div>
      }
      <button (click)="onLogout()" class="w-full flex items-center justify-center px-4 py-2.5 rounded-lg bg-red-600 hover:bg-red-700 text-white font-semibold transition-colors duration-200">
        <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9" /></svg>
        Logout
      </button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="flex-1 flex flex-col overflow-hidden">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
      <div class="container mx-auto px-4 sm:px-8">
        <div class="h-16 flex items-center justify-between">
          <div class="flex items-center">
            <button (click)="isSidebarOpen.set(true)" class="sm:hidden p-2 -ml-2 mr-2 rounded-md text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none">
              <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
              </svg>
            </button>
            <h2 class="text-xl font-bold text-gray-800 dark:text-gray-200">
              @switch (activeTab()) {
                @case ('analytics') { Analytics Dashboard }
                @case ('manage-employees') { Manage Employees }
                @case ('dtr') { DTR Logs }
                @case ('payroll') { Payroll History }
                @case ('manage-payroll') { Manage Payroll }
                @case ('daily-logs') { Daily Logs }
                @case ('recovery') { Recovery Bin }
              }
            </h2>
          </div>
        </div>
      </div>
    </header>
    
    <!-- Global Notification -->
    @if(notification(); as notif) {
      <div class="fixed top-20 right-8 z-50 w-full max-w-sm">
        <div class="rounded-lg shadow-lg p-4" [class.bg-green-500]="notif.type === 'success'" [class.bg-red-500]="notif.type === 'error'">
          <p class="text-white font-medium">{{ notif.message }}</p>
        </div>
      </div>
    }

    <!-- Content -->
    <main class="flex-1 overflow-x-hidden overflow-y-auto">
      <div class="container mx-auto px-4 sm:px-8 py-8">
        @switch (activeTab()) {
          @case ('analytics') {
            <div class="space-y-8">
              <!-- Stat Cards -->
              <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
                  <!-- Total Employees -->
                  <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md flex items-center">
                      <div class="bg-indigo-500/10 dark:bg-indigo-500/20 p-3 rounded-full">
                          <svg class="w-6 h-6 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.962A3 3 0 013 18.72v-2.172a3 3 0 013.741-2.72 9.094 9.094 0 017.5 0 3 3 0 013.741 2.72v2.172a3 3 0 01-3.741 2.72 9.094 9.094 0 01-7.5 0 3 3 0 01-3.741-2.72M12 12A3 3 0 1012 6a3 3 0 000 6z" /></svg>
                      </div>
                      <div class="ml-4">
                          <p class="text-sm text-gray-500 dark:text-gray-400 font-medium">Total Employees</p>
                          <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ totalEmployees() }}</p>
                      </div>
                  </div>
                  <!-- Branches -->
                  <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md flex items-center">
                       <div class="bg-sky-500/10 dark:bg-sky-500/20 p-3 rounded-full">
                          <svg class="w-6 h-6 text-sky-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h6.375M9 12h6.375m-6.375 5.25h6.375M5.25 6h.008v.008H5.25V6zm.008 5.25h.008v.008H5.258v-.008zm0 5.25h.008v.008H5.258v-.008zm13.5-5.25h.008v.008h-.008v-.008zm0 5.25h.008v.008h-.008v-.008zM5.25 3h.008v.008H5.25V3zm13.5 0h.008v.008h-.008V3z" /></svg>
                       </div>
                       <div class="ml-4">
                           <p class="text-sm text-gray-500 dark:text-gray-400 font-medium">Branches</p>
                           <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ totalBranches() }}</p>
                       </div>
                  </div>
                  <!-- Present Today -->
                  <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md flex items-center">
                      <div class="bg-emerald-500/10 dark:bg-emerald-500/20 p-3 rounded-full">
                          <svg class="w-6 h-6 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                      </div>
                      <div class="ml-4">
                           <p class="text-sm text-gray-500 dark:text-gray-400 font-medium">Present Today</p>
                           <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ dtrSummary().present }}</p>
                      </div>
                  </div>
                  <!-- Late Today -->
                  <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md flex items-center">
                      <div class="bg-amber-500/10 dark:bg-amber-500/20 p-3 rounded-full">
                          <svg class="w-6 h-6 text-amber-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" /></svg>
                      </div>
                      <div class="ml-4">
                          <p class="text-sm text-gray-500 dark:text-gray-400 font-medium">Late Today</p>
                          <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ dtrSummary().late }}</p>
                      </div>
                  </div>
              </div>

              <!-- Charts -->
              <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                <!-- Branch Distribution Donut Chart -->
                <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                  <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Distribution by Branch</h3>
                  @if(distributionByBranch().length > 0) {
                  <div class="mt-6 flex justify-center items-center">
                      <div class="relative w-48 h-48">
                      <svg class="w-full h-full -rotate-90" viewBox="0 0 36 36">
                          <circle cx="18" cy="18" r="15.9155" class="stroke-current text-gray-200 dark:text-gray-700" stroke-width="3" fill="transparent"></circle>
                          @for(branch of distributionByBranch(); track branch.name) {
                              <circle 
                              cx="18" 
                              cy="18" 
                              r="15.9155" 
                              [class]="branch.textColor"
                              stroke-width="3.5" 
                              fill="transparent" 
                              [attr.stroke-dasharray]="branch.percentage + ', 100'"
                              [attr.stroke-dashoffset]="-branch.offset"
                              ></circle>
                          }
                      </svg>
                      <div class="absolute inset-0 flex flex-col items-center justify-center">
                          <span class="text-3xl font-bold text-gray-800 dark:text-gray-200">{{ totalEmployees() }}</span>
                          <span class="text-sm text-gray-500 dark:text-gray-400">Employees</span>
                      </div>
                      </div>
                  </div>
                  <div class="mt-6 space-y-2">
                      @for(branch of distributionByBranch(); track branch.name) {
                        <div class="flex justify-between items-center text-sm">
                          <div class="flex items-center">
                              <span class="w-3 h-3 rounded-full mr-2" [class]="branch.bgColor"></span>
                              <span class="text-gray-700 dark:text-gray-300 capitalize">{{ branch.name }}</span>
                          </div>
                          <span class="font-semibold text-gray-900 dark:text-white">{{ branch.count }} ({{ branch.percentage | number:'1.1-1' }}%)</span>
                        </div>
                      }
                  </div>
                  } @else {
                    <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400 py-16">No employee data to display.</div>
                  }
                </div>

                <!-- Position Distribution Bar Chart -->
                <div class="lg:col-span-3 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                  <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Distribution by Position</h3>
                   @if(distributionByPosition().length > 0) {
                    <div class="mt-6 h-64 flex items-end justify-around gap-x-4">
                      @for(pos of distributionByPosition(); track pos.name) {
                        <div class="bar-container flex-1 flex flex-col items-center justify-end h-full">
                          <div class="bar-tooltip absolute -top-10 bg-gray-800 text-white text-xs rounded-md py-1 px-2">
                            {{ pos.count }}
                          </div>
                          <div class="chart-bar w-3/4 rounded-t-md" [style.height.%]="pos.heightPercentage" [class]="pos.color"></div>
                          <p class="text-xs text-center text-gray-500 dark:text-gray-400 mt-2 capitalize">{{ pos.name }}</p>
                        </div>
                      }
                    </div>
                  } @else {
                     <div class="flex items-center justify-center h-64 text-gray-500 dark:text-gray-400">No employee data to display.</div>
                  }
                </div>
                
                <!-- Monthly Attendance Summary -->
                <div class="lg:col-span-5 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                  <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-1">Monthly Attendance Summary ({{ dtrViewDate() | date:'MMMM yyyy' }})</h3>
                  <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Overview of workdays for all employees this month.</p>
                  @if(monthlyAttendanceSummary().total > 0) {
                  <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-8 flex overflow-hidden">
                      @for(stat of monthlyAttendanceSummary().stats; track stat.name) {
                      <div [style.width.%]="stat.percentage" [class]="stat.color" class="h-full flex items-center justify-center text-white text-xs font-bold" [title]="stat.name + ': ' + (stat.percentage | number:'1.1-1') + '%'">
                      </div>
                      }
                  </div>
                  <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                      @for(stat of monthlyAttendanceSummary().stats; track stat.name) {
                        <div class="flex items-center">
                          <span class="w-3 h-3 rounded-full mr-2" [class]="stat.color"></span>
                          <span class="text-gray-700 dark:text-gray-300">{{ stat.name }}:</span>
                          <span class="font-semibold text-gray-900 dark:text-white ml-auto">{{ stat.count }}</span>
                        </div>
                      }
                  </div>
                  } @else {
                    <div class="flex items-center justify-center h-32 text-gray-500 dark:text-gray-400">No attendance data for this month.</div>
                  }
                </div>
              </div>
            </div>
          }
          @case ('manage-employees') { 
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
              <!-- Header & Actions -->
              <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="relative w-full sm:w-64">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                       <svg class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" /></svg>
                    </div>
                    <input type="text" [ngModel]="searchTerm()" (ngModelChange)="searchTerm.set($event)" placeholder="Search employees..." class="w-full pl-10 pr-4 py-2 rounded-md bg-gray-100 dark:bg-slate-700 border-2 border-transparent focus:border-indigo-500 focus:bg-white dark:focus:bg-slate-800 focus:ring-0 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition">
                </div>
                <div class="flex items-center gap-2">
                    <button (click)="openAddEmployeeModal()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 font-semibold text-sm">Add Employee</button>
                    <button (click)="isSetScheduleModalVisible.set(true)" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-semibold text-sm">Set Schedules</button>
                </div>
              </div>
              
              <!-- Bulk Actions Bar -->
              @if(isMultiSelectMode()) {
                <div class="p-4 bg-indigo-50 dark:bg-indigo-900/20 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                    <span class="text-sm font-medium text-indigo-700 dark:text-indigo-300">{{ selectedEmployees().size }} selected</span>
                    <div class="flex items-center gap-2">
                        <button (click)="openBulkDetailsModal()" [disabled]="selectedEmployees().size === 0" class="text-sm font-medium text-indigo-600 hover:text-indigo-800 dark:text-indigo-300 dark:hover:text-indigo-100 disabled:opacity-50 disabled:cursor-not-allowed">View Details</button>
                        <button (click)="openBulkIdCardModal()" [disabled]="selectedEmployees().size === 0" class="text-sm font-medium text-indigo-600 hover:text-indigo-800 dark:text-indigo-300 dark:hover:text-indigo-100 disabled:opacity-50 disabled:cursor-not-allowed">View IDs</button>
                        <button (click)="openBulkDtrExportModal()" [disabled]="selectedEmployees().size === 0" class="text-sm font-medium text-indigo-600 hover:text-indigo-800 dark:text-indigo-300 dark:hover:text-indigo-100 disabled:opacity-50 disabled:cursor-not-allowed">Export DTRs</button>
                        <button (click)="openEditEmployeeModal()" [disabled]="selectedEmployees().size !== 1" class="text-sm font-medium text-indigo-600 hover:text-indigo-800 dark:text-indigo-300 dark:hover:text-indigo-100 disabled:opacity-50 disabled:cursor-not-allowed">Edit</button>
                        <button (click)="openDeleteConfirmation()" [disabled]="selectedEmployees().size === 0" class="text-sm font-medium text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-200 disabled:opacity-50 disabled:cursor-not-allowed">Delete</button>
                    </div>
                </div>
              }

              <!-- Table -->
              <div class="overflow-x-auto">
                @if(employeesLoading()) {
                  <p class="p-8 text-center text-gray-500 dark:text-gray-400">Loading employees...</p>
                } @else if(employeesError()) {
                  <p class="p-8 text-center text-red-500 dark:text-red-400">{{ employeesError() }}</p>
                } @else if(filteredEmployees().length === 0) {
                  <p class="p-8 text-center text-gray-500 dark:text-gray-400">No employees found.</p>
                } @else {
                  <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700/50">
                      <tr>
                        <th class="p-4 text-left">
                          <input type="checkbox" [checked]="isMultiSelectMode()" (change)="toggleMultiSelectMode()" class="h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-indigo-600 focus:ring-indigo-500 bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800">
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Employee</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Branch</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Position</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Hire Date</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                      @for(emp of filteredEmployees(); track emp.id) {
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                          <td class="p-4">
                            @if(isMultiSelectMode()) {
                              <input type="checkbox" [checked]="selectedEmployees().has(emp.id)" (change)="toggleEmployeeSelection(emp.id)" class="h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-indigo-600 focus:ring-indigo-500 bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800">
                            }
                          </td>
                          <td class="px-4 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                              <div class="flex-shrink-0 h-10 w-10">
                                @if(emp.avatar_url) {
                                  <img class="h-10 w-10 rounded-full object-cover" [src]="emp.avatar_url" alt="">
                                } @else {
                                  <span class="h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                                    <svg class="h-6 w-6 text-gray-400 dark:text-gray-500" fill="currentColor" viewBox="0 0 24 24"><path d="M24 20.993V24H0v-2.993A1 1 0 001 18h22a1 1 0 001 2.993zM12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z"></path></svg>
                                  </span>
                                }
                              </div>
                              <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900 dark:text-white">{{ emp.first_name }} {{ emp.last_name }}</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">{{ emp.employee_id }}</div>
                              </div>
                            </div>
                          </td>
                          <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 capitalize">{{ emp.branch }}</td>
                          <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 capitalize">{{ emp.position }}</td>
                          <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{ emp.hire_date | date:'mediumDate' }}</td>
                          <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex items-center gap-2">
                                <button (click)="openViewEmployeeModal(emp)" title="View Details" class="p-2 text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.432 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></button>
                                <button (click)="openIdCardModal(emp)" title="View ID Card" class="p-2 text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" /></svg></button>
                                <button (click)="openDtrExportModal(emp)" title="Export DTR" class="p-2 text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg></button>
                            </div>
                          </td>
                        </tr>
                      }
                    </tbody>
                  </table>
                }
              </div>
            </div>
          }
          @case ('dtr') {
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
              <!-- Header -->
              <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-2">
                  <button (click)="changeDtrMonth(-1)" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700" title="Previous month">
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" /></svg>
                  </button>
                  <h3 class="text-xl font-bold w-40 text-center">{{ dtrViewDate() | date:'MMMM yyyy' }}</h3>
                  <button (click)="changeDtrMonth(1)" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700" title="Next month">
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" /></svg>
                  </button>
                </div>
                <div class="relative">
                  <button (click)="isPayrollPeriodSelectorVisible.set(!isPayrollPeriodSelectorVisible())" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-semibold text-sm flex items-center gap-2">
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>
                    Run Payroll
                  </button>
                  @if (isPayrollPeriodSelectorVisible()) {
                    <div class="absolute right-0 mt-2 w-72 bg-white dark:bg-gray-700 rounded-lg shadow-xl z-10 border dark:border-gray-600">
                        @if (availablePayPeriods().length > 0) {
                            <ul class="max-h-60 overflow-y-auto">
                                @for (period of availablePayPeriods(); track period.id) {
                                  <li>
                                    <button (click)="openRunPayrollForPeriod(period)" [disabled]="period.isProcessed" class="w-full text-left px-4 py-3 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
                                      {{ period.display }}
                                      @if (period.isProcessed) { <span class="text-xs text-green-500 dark:text-green-400 float-right">Processed</span> }
                                    </button>
                                  </li>
                                }
                            </ul>
                        } @else {
                            <p class="p-4 text-sm text-gray-500 dark:text-gray-400">No available pay periods with time entries found.</p>
                        }
                    </div>
                  }
                </div>
              </div>

              <!-- Timesheet Table -->
              <div class="overflow-x-auto">
                @if (dtrDataLoading()) {
                   <p class="p-8 text-center text-gray-500 dark:text-gray-400">Loading timesheet...</p>
                } @else if (dtrTimesheetData().length === 0) {
                   <p class="p-8 text-center text-gray-500 dark:text-gray-400">No employee data to display for this month.</p>
                } @else {
                  <table class="min-w-full text-sm whitespace-nowrap">
                    <thead class="bg-gray-50 dark:bg-gray-700/50">
                      <tr>
                        <th class="sticky left-0 bg-gray-50 dark:bg-gray-700/50 z-10 px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Employee</th>
                        @for(day of dtrCalendarDays(); track day.dateStr) {
                          <th class="text-center p-2 border-l border-gray-200 dark:border-gray-700" [class.bg-blue-50]="day.isToday" [class.dark:bg-blue-900/20]="day.isToday">
                            <span class="font-normal">{{ day.dayName }}</span><br>
                            <span class="font-bold text-base">{{ day.dayOfMonth }}</span>
                          </th>
                        }
                      </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 dark:divide-gray-600">
                      @for(row of dtrTimesheetData(); track row.employee.id) {
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/20">
                          <td class="sticky left-0 bg-white dark:bg-gray-800 z-10 px-4 py-2 font-medium text-gray-900 dark:text-white">{{ row.employee.first_name }} {{ row.employee.last_name }}</td>
                          @for(day of row.days; track day.dateStr) {
                            <td class="border-l border-gray-200 dark:border-gray-700 text-center align-middle" [class.bg-blue-50]="day.isToday" [class.dark:bg-blue-900/20]="day.isToday">
                               @switch(day.status) {
                                  @case('Present') { <span class="inline-block w-4 h-4 bg-green-500 rounded-full" title="Present: {{ day.hoursWorked }} hrs"></span> }
                                  @case('Late') { <span class="inline-block w-4 h-4 bg-yellow-500 rounded-full" title="Late: {{ day.hoursWorked }} hrs"></span> }
                                  @case('Absent') { <span class="inline-block w-4 h-4 bg-red-500 rounded-full" title="Absent"></span> }
                                  @case('Leave') { <span class="inline-block w-4 h-4 bg-blue-500 rounded-full" title="On Leave"></span> }
                                  @case('Weekend') { <span class="text-gray-300 dark:text-gray-600">-</span> }
                                  @case('NoSchedule') { <span class="text-gray-400 dark:text-gray-500 text-xs">OFF</span> }
                                }
                            </td>
                          }
                        </tr>
                      }
                    </tbody>
                  </table>
                }
              </div>
            </div>
          }
          @case ('payroll') {
            <div class="space-y-4">
              @if (payrollsLoading()) {
                <p class="p-8 text-center text-gray-500 dark:text-gray-400">Loading payroll history...</p>
              } @else if (payrollsError()) {
                <p class="p-8 text-center text-red-500 dark:text-red-400">{{ payrollsError() }}</p>
              } @else if (groupedPayrolls().length === 0) {
                <p class="p-8 text-center text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-lg shadow-md">No payrolls have been processed yet.</p>
              } @else {
                @for(group of groupedPayrolls(); track group.monthYearValue) {
                  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
                    <button (click)="togglePayrollMonth(group.monthYearValue)" class="w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 dark:hover:bg-gray-700/50">
                      <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">{{ group.monthYearDisplay }}</h3>
                      <svg class="w-5 h-5 text-gray-500 dark:text-gray-400 transition-transform" [class.rotate-180]="openPayrollMonths().has(group.monthYearValue)" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" /></svg>
                    </button>
                    @if(openPayrollMonths().has(group.monthYearValue)) {
                      <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                          <thead class="bg-gray-50 dark:bg-gray-700/50">
                            <tr>
                              <th class="px-6 py-3 text-left font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Employee</th>
                              <th class="px-6 py-3 text-left font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Pay Period</th>
                              <th class="px-6 py-3 text-left font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Net Pay</th>
                              <th class="px-6 py-3 text-left font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                            </tr>
                          </thead>
                          <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                            @for(p of group.payrolls; track p.id) {
                              <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/20">
                                <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900 dark:text-white">{{ p.profiles?.first_name }} {{ p.profiles?.last_name }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400">{{ p.pay_period_start | date:'shortDate' }} - {{ p.pay_period_end | date:'shortDate' }}</td>
                                <td class="px-6 py-4 whitespace-nowrap font-semibold text-gray-900 dark:text-white">{{ p.net_pay | currency:'PHP' }}</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                  <select (change)="onPayrollStatusChange(p.id, $event)" [value]="p.status" class="text-xs rounded-full border-0 focus:ring-2 focus:ring-indigo-500 transition-colors"
                                    [class.bg-green-100]="p.status === 'Paid'" [class.text-green-800]="p.status === 'Paid'" [class.dark:bg-green-900/50]="p.status === 'Paid'" [class.dark:text-green-300]="p.status === 'Paid'"
                                    [class.bg-yellow-100]="p.status === 'Delayed'" [class.text-yellow-800]="p.status === 'Delayed'" [class.dark:bg-yellow-900/50]="p.status === 'Delayed'" [class.dark:text-yellow-300]="p.status === 'Delayed'"
                                    [class.bg-red-100]="p.status === 'Unpaid'" [class.text-red-800]="p.status === 'Unpaid'" [class.dark:bg-red-900/50]="p.status === 'Unpaid'" [class.dark:text-red-300]="p.status === 'Unpaid'">
                                    <option value="Paid">Paid</option>
                                    <option value="Delayed">Delayed</option>
                                    <option value="Unpaid">Unpaid</option>
                                  </select>
                                </td>
                              </tr>
                            }
                          </tbody>
                        </table>
                      </div>
                    }
                  </div>
                }
              }
            </div>
          }
          @case ('manage-payroll') {
             <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                <!-- Left: Settings Form -->
                <div class="lg:col-span-2 space-y-8">
                  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
                    <h3 class="p-4 border-b border-gray-200 dark:border-gray-700 text-lg font-semibold">Company Settings</h3>
                    @if (settingsLoading()) {
                       <p class="p-8 text-center text-gray-500 dark:text-gray-400">Loading settings...</p>
                    } @else {
                      <form #settingsForm="ngForm" (ngSubmit)="savePayrollSettings()" class="p-6 space-y-6">
                          <div>
                              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Deduction Rate per Minute (PHP)</label>
                              <input type="number" name="late_rate" [(ngModel)]="payrollSettings().late_rate_per_minute" required class="mt-1 block w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 focus:border-indigo-500 focus:ring-0">
                          </div>
                           <div>
                              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Lateness Grace Period (minutes)</label>
                              <input type="number" name="grace_period" [(ngModel)]="payrollSettings().grace_period_minutes" required class="mt-1 block w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 focus:border-indigo-500 focus:ring-0">
                          </div>
                           <div class="pt-4 border-t dark:border-gray-700">
                             <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Birth Month Bonus</h4>
                              @for(pos of positions(); track pos.id) {
                                <div class="flex items-center gap-2 mb-2">
                                  <label class="w-1/2 capitalize">{{pos.name}}</label>
                                  <input type="number" [name]="'bonus_'+pos.name" [(ngModel)]="payrollSettings().birth_month_bonus[pos.name]" required class="block w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 focus:border-indigo-500 focus:ring-0">
                                </div>
                              }
                           </div>
                          <div class="pt-4">
                              <button type="submit" [disabled]="settingsForm.invalid" class="w-full px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 font-semibold text-sm disabled:bg-indigo-400 disabled:cursor-not-allowed">Save Settings</button>
                          </div>
                      </form>
                    }
                  </div>
                </div>

                <!-- Right: Salary Rules Table -->
                <div class="lg:col-span-3 bg-white dark:bg-gray-800 rounded-lg shadow-md">
                    <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                        <h3 class="text-lg font-semibold">Salary Adjustment Rules</h3>
                        <button (click)="openAddSalaryRuleModal()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-semibold text-sm">Add New Rule</button>
                    </div>
                     @if (salaryRulesLoading()) {
                        <p class="p-8 text-center text-gray-500 dark:text-gray-400">Loading rules...</p>
                     } @else if (salaryRules().length === 0) {
                        <p class="p-8 text-center text-gray-500 dark:text-gray-400">No salary rules created yet.</p>
                     } @else {
                        <div class="overflow-x-auto">
                           <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                              <thead class="bg-gray-50 dark:bg-gray-700/50">
                                <tr>
                                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Name</th>
                                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Raise %</th>
                                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Period</th>
                                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                </tr>
                              </thead>
                              <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                @for (rule of salaryRules(); track rule.id) {
                                  <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">{{rule.name}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{rule.raise_percentage}}%</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{rule.start_date | date}} - {{rule.end_date | date}}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full" [class.bg-green-100]="rule.is_active" [class.text-green-800]="rule.is_active" [class.dark:bg-green-900/50]="rule.is_active" [class.dark:text-green-300]="rule.is_active" [class.bg-gray-100]="!rule.is_active" [class.text-gray-800]="!rule.is_active" [class.dark:bg-gray-700]="!rule.is_active" [class.dark:text-gray-300]="!rule.is_active">
                                        {{ rule.is_active ? 'Active' : 'Inactive' }}
                                      </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                      <div class="flex items-center gap-2">
                                        <button (click)="openEditSalaryRuleModal(rule)" class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-200">Edit</button>
                                        <button (click)="openDeleteSalaryRuleConfirmation(rule)" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200">Delete</button>
                                      </div>
                                    </td>
                                  </tr>
                                }
                              </tbody>
                           </table>
                        </div>
                     }
                </div>
              </div>
          }
          @case ('daily-logs') {
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
              @if (dailyLogsLoading()) {
                <p class="p-8 text-center text-gray-500 dark:text-gray-400">Loading daily logs...</p>
              } @else if (dailyLogsError()) {
                <p class="p-8 text-center text-red-500 dark:text-red-400">{{ dailyLogsError() }}</p>
              } @else if (liveEmployeeStatus().length === 0) {
                 <p class="p-8 text-center text-gray-500 dark:text-gray-400">No employees to display.</p>
              } @else {
                <div class="overflow-x-auto">
                  <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700/50">
                      <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Employee</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Today's Schedule</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Timer / Total Work</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Last Event</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                      @for (item of liveEmployeeStatus(); track item.profile.id) {
                        <tr>
                          <td class="px-6 py-4 whitespace-nowrap">
                             <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                   @if(item.profile.avatar_url) {
                                      <img class="h-10 w-10 rounded-full object-cover" [src]="item.profile.avatar_url" alt="">
                                    } @else {
                                      <span class="h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                                        <svg class="h-6 w-6 text-gray-400 dark:text-gray-500" fill="currentColor" viewBox="0 0 24 24"><path d="M24 20.993V24H0v-2.993A1 1 0 001 18h22a1 1 0 001 2.993zM12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z"></path></svg>
                                      </span>
                                    }
                                </div>
                                <div class="ml-4">
                                  <div class="text-sm font-medium text-gray-900 dark:text-white">{{ item.profile.first_name }} {{ item.profile.last_name }}</div>
                                  <div class="text-sm text-gray-500 dark:text-gray-400">{{ item.profile.employee_id }}</div>
                                </div>
                              </div>
                          </td>
                          <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                              [class.bg-green-100]="item.status === 'Timed In'" [class.text-green-800]="item.status === 'Timed In'" [class.dark:bg-green-900/50]="item.status === 'Timed In'" [class.dark:text-green-300]="item.status === 'Timed In'"
                              [class.bg-yellow-100]="item.status === 'On Break'" [class.text-yellow-800]="item.status === 'On Break'" [class.dark:bg-yellow-900/50]="item.status === 'On Break'" [class.dark:text-yellow-300]="item.status === 'On Break'"
                              [class.bg-blue-100]="item.status.startsWith('On Leave')" [class.text-blue-800]="item.status.startsWith('On Leave')" [class.dark:bg-blue-900/50]="item.status.startsWith('On Leave')" [class.dark:text-blue-300]="item.status.startsWith('On Leave')"
                              [class.bg-gray-100]="item.status === 'Timed Out' || item.status === 'No Schedule' || item.status === 'Day Off'" [class.text-gray-800]="item.status === 'Timed Out' || item.status === 'No Schedule' || item.status === 'Day Off'" [class.dark:bg-gray-700]="item.status === 'Timed Out' || item.status === 'No Schedule' || item.status === 'Day Off'" [class.dark:text-gray-300]="item.status === 'Timed Out' || item.status === 'No Schedule' || item.status === 'Day Off'"
                              [class.bg-red-100]="item.status === 'Absent' || item.status === 'Emergency Leave'" [class.text-red-800]="item.status === 'Absent' || item.status === 'Emergency Leave'" [class.dark:bg-red-900/50]="item.status === 'Absent' || item.status === 'Emergency Leave'" [class.dark:text-red-300]="item.status === 'Absent' || item.status === 'Emergency Leave'">
                              {{ item.status }}
                            </span>
                          </td>
                          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{ item.todaysSchedule }}</td>
                          <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-700 dark:text-gray-200">{{ item.timerDisplay }}</td>
                          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{ item.lastEventTime | date:'shortTime' }}</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              }
            </div>
          }
          @case ('recovery') {
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
              <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold">Recovery Bin</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400">Restore or permanently delete employee records.</p>
              </div>
              @if (recoveryLoading()) {
                <p class="p-8 text-center text-gray-500 dark:text-gray-400">Loading deleted employees...</p>
              } @else if (recoveryError()) {
                <p class="p-8 text-center text-red-500 dark:text-red-400">{{ recoveryError() }}</p>
              } @else if (deletedEmployees().length === 0) {
                <p class="p-8 text-center text-gray-500 dark:text-gray-400">The recovery bin is empty.</p>
              } @else {
                <div class="overflow-x-auto">
                  <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700/50">
                      <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Employee</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                      @for (emp of deletedEmployees(); track emp.id) {
                        <tr>
                          <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900 dark:text-white">{{ emp.first_name }} {{ emp.last_name }}</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">{{ emp.email }}</div>
                          </td>
                          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex items-center gap-4">
                              <button (click)="handleRecoverEmployee(emp)" class="text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-200">Recover</button>
                              <button (click)="openPermanentDeleteConfirmation(emp)" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200">Delete Permanently</button>
                            </div>
                          </td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              }
            </div>
          }
        }
      </div>
    </main>
  </div>
</div>

<!-- All Modals -->
<app-add-employee-modal 
  [visible]="isAddEmployeeModalVisible()"
  [currentUserRole]="currentUserRole()"
  [employeeToEdit]="employeeToEdit()"
  (close)="closeEmployeeModal()"
  (employeeSaved)="onEmployeeSaved()"
></app-add-employee-modal>

<app-run-payroll-modal
  [visible]="isRunPayrollModalVisible()"
  [payPeriod]="selectedPayPeriod()"
  [payrollSettings]="payrollSettings()"
  (close)="closeRunPayrollModal()"
  (payrollRun)="refreshPayrolls()"
></app-run-payroll-modal>

<app-confirmation-modal
  [visible]="isConfirmModalVisible()"
  [title]="confirmModalConfig().title"
  [message]="confirmModalConfig().message"
  (close)="isConfirmModalVisible.set(false)"
  (confirm)="confirmModalConfig().onConfirm()"
></app-confirmation-modal>

<app-view-employee-modal
  [visible]="isViewEmployeeModalVisible()"
  [employee]="selectedEmployeeForModal()"
  (close)="isViewEmployeeModalVisible.set(false)"
></app-view-employee-modal>

<app-id-card-modal
  [visible]="isIdCardModalVisible()"
  [employee]="selectedEmployeeForModal()"
  (close)="isIdCardModalVisible.set(false)"
></app-id-card-modal>

<app-set-schedule-modal
  [visible]="isSetScheduleModalVisible()"
  [employees]="employees()"
  (close)="isSetScheduleModalVisible.set(false)"
></app-set-schedule-modal>

<app-dtr-export-modal
  [visible]="isDtrExportModalVisible()"
  [employee]="selectedEmployeeForModal()"
  (close)="isDtrExportModalVisible.set(false)"
></app-dtr-export-modal>

<app-salary-adjustment-modal
  [visible]="isSalaryAdjustmentModalVisible()"
  [adjustmentToEdit]="adjustmentToEdit()"
  (close)="closeSalaryRuleModal()"
  (saved)="onSalaryRuleSaved()"
></app-salary-adjustment-modal>

@if(selectedEmployeeIdsArray().length > 0) {
  <app-dtr-bulk-export-modal
    [visible]="isDtrBulkExportModalVisible()"
    [employeeIds]="selectedEmployeeIdsArray()"
    [employees]="selectedEmployeeProfiles()"
    (close)="isDtrBulkExportModalVisible.set(false)"
  ></app-dtr-bulk-export-modal>
  
  <app-id-card-bulk-view-modal
    [visible]="isIdCardBulkViewModalVisible()"
    [employees]="selectedEmployeeProfiles()"
    (close)="isIdCardBulkViewModalVisible.set(false)"
  ></app-id-card-bulk-view-modal>

  <app-employee-details-bulk-view-modal
    [visible]="isEmployeeDetailsBulkViewModalVisible()"
    [employees]="selectedEmployeeProfiles()"
    (close)="isEmployeeDetailsBulkViewModalVisible.set(false)"
  ></app-employee-details-bulk-view-modal>
}